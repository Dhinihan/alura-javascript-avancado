{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["NegociacaoDao","Negociacao","ConnectionFactory","HttpService","NegociacaoService","_http","negociacao","getConnection","then","conn","dao","adiciona","catch","_mensagem","texto","error","listaTodos","lista","apagaTodos","url","erro","Promise","resolve","reject","get","negociacoes","map","Date","dados","data","valor","quantidade","console","log","backErro","_getNegociacoes","all","getNegociacoesDaSemana","getNegociacoesDaSemanaAnterior","getNegociacoesDaSemanaRetrasada","importacoes","reduce","arrayAchatado","array","concat"],"mappings":";;;;;;;;;;;;;;;AAASA,mB,qBAAAA,a;;AACAC,gB,qBAAAA,U;;AACAC,uB,sBAAAA,iB;;AACAC,iB,gBAAAA,W;;;;;;;;;;;;;;;;;;;;;mCAEIC,iB;AAEX,qCAAc;AAAA;;AACZ,eAAKC,KAAL,GAAa,IAAIF,WAAJ,EAAb;AACD;;AAED;;;;;;;;;mCAKSG,U,EAAY;AAAA;;AACnB,mBAAOJ,kBAAkBK,aAAlB,GACJC,IADI,CACC;AAAA,qBAAQ,IAAIR,aAAJ,CAAkBS,IAAlB,CAAR;AAAA,aADD,EAEJD,IAFI,CAEC;AAAA,qBAAOE,IAAIC,QAAJ,CAAaL,UAAb,CAAP;AAAA,aAFD,EAGJE,IAHI,CAGC;AAAA,qBAAM,mCAAN;AAAA,aAHD,EAIJI,KAJI,CAIE;AAAA,qBAAS,MAAKC,SAAL,CAAeC,KAAf,GAAuBC,KAAhC;AAAA,aAJF,CAAP;AAKD;;;kCAKO;AACN,mBAAOb,kBAAkBK,aAAlB,GACJC,IADI,CACC;AAAA,qBAAQ,IAAIR,aAAJ,CAAkBS,IAAlB,CAAR;AAAA,aADD,EAEJD,IAFI,CAEC;AAAA,qBAAOE,IAAIM,UAAJ,EAAP;AAAA,aAFD,CAAP;AAGD;;;gCAOKC,K,EAAO;AACX,mBAAOf,kBAAkBK,aAAlB,GACJC,IADI,CACC;AAAA,qBAAQ,IAAIR,aAAJ,CAAkBS,IAAlB,CAAR;AAAA,aADD,EAEJD,IAFI,CAEC;AAAA,qBAAOE,IAAIQ,UAAJ,EAAP;AAAA,aAFD,EAGJV,IAHI,CAGC;AAAA,qBAAM,kCAAN;AAAA,aAHD,CAAP;AAID;;;0CAOeW,G,EAAKC,I,EAAM;AAAA;;AAEzB,mBAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,qBAAKlB,KAAL,CAAWmB,GAAX,CAAeL,GAAf,EAAoBX,IAApB,CAAyB;AAAA,uBAAec,QAAQG,YAAYC,GAAZ,CAC9C;AAAA,yBAAS,IAAIzB,UAAJ,CAAe,IAAI0B,IAAJ,CAASC,MAAMC,IAAf,CAAf,EAAqCD,MAAME,KAA3C,EAAkDF,MAAMG,UAAxD,CAAT;AAAA,iBAD8C,CAAR,CAAf;AAAA,eAAzB,EAEInB,KAFJ,CAEU,oBAAY;AACpBoB,wBAAQC,GAAR,CAAYC,QAAZ;AACAX,uBAAOH,IAAP;AACD,eALD;AAMD,aAPM,CAAP;AAQD;;;mDAKwB;AACvB,mBAAO,KAAKe,eAAL,CAAqB,oBAArB,EAA2C,qDAA3C,CAAP;AACD;;;2DAKgC;AAC/B,mBAAO,KAAKA,eAAL,CAAqB,sBAArB,EAA6C,8DAA7C,CAAP;AACD;;;4DAKiC;AAChC,mBAAO,KAAKA,eAAL,CACL,uBADK,EAEL,+DAFK,CAAP;AAGD;;;+CAEoB;AACnB,mBAAOd,QAAQe,GAAR,CAAY,CACjB,KAAKC,sBAAL,EADiB,EAEjB,KAAKC,8BAAL,EAFiB,EAGjB,KAAKC,+BAAL,EAHiB,CAAZ,EAIJ/B,IAJI,CAIC;AAAA,qBAAegC,YAAYC,MAAZ,CAAmB,UAACC,aAAD,EAAgBC,KAAhB;AAAA,uBAA0BD,cAAcE,MAAd,CAAqBD,KAArB,CAA1B;AAAA,eAAnB,EAA0E,EAA1E,CAAf;AAAA,aAJD,CAAP;AAKD","file":"NegociacaoService.js","sourcesContent":["import { NegociacaoDao } from '../dao/NegociacaoDao';\nimport { Negociacao } from '../models/Negociacao';\nimport { ConnectionFactory } from './ConnectionFactory';\nimport { HttpService } from './HttpService';\n\nexport class NegociacaoService {\n\n  constructor() {\n    this._http = new HttpService();\n  }\n\n  /**\n   *\n   * @param {Negociacao} negociacao\n   * @returns {Promise<string>}\n   */\n  cadastra(negociacao) {\n    return ConnectionFactory.getConnection()\n      .then(conn => new NegociacaoDao(conn))\n      .then(dao => dao.adiciona(negociacao))\n      .then(() => 'Negociação adicionada com sucesso')\n      .catch(error => this._mensagem.texto = error);\n  }\n\n  /**\n   * @returns {Promise<Negociacao[]>}\n   */\n  lista() {\n    return ConnectionFactory.getConnection()\n      .then(conn => new NegociacaoDao(conn))\n      .then(dao => dao.listaTodos());\n  }\n\n  /**\n   *\n   * @param {Negociacao[]} lista\n   * @returns {Promise<string>}\n   */\n  apaga(lista) {\n    return ConnectionFactory.getConnection()\n      .then(conn => new NegociacaoDao(conn))\n      .then(dao => dao.apagaTodos())\n      .then(() => \"Negociações apagadas com sucesso\");\n  }\n\n  /**\n   *\n   * @param {string} url\n   * @param {string} erro\n   */\n  _getNegociacoes(url, erro) {\n\n    return new Promise((resolve, reject) => {\n      this._http.get(url).then(negociacoes => resolve(negociacoes.map(\n        dados => new Negociacao(new Date(dados.data), dados.valor, dados.quantidade)\n      ))).catch(backErro => {\n        console.log(backErro);\n        reject(erro);\n      });\n    });\n  }\n\n  /**\n   * @returns {Promise}\n   */\n  getNegociacoesDaSemana() {\n    return this._getNegociacoes('negociacoes/semana', 'Não foi possível importar as negociações da semana.');\n  }\n\n  /**\n   * @returns {Promise}\n   */\n  getNegociacoesDaSemanaAnterior() {\n    return this._getNegociacoes('negociacoes/anterior', 'Não foi possível importar as negociações da semana anterior.');\n  }\n\n  /**\n   * @returns {Promise}\n   */\n  getNegociacoesDaSemanaRetrasada() {\n    return this._getNegociacoes(\n      'negociacoes/retrasada',\n      'Não foi possível importar as negociações da semana retrasada.');\n  }\n\n  importaNegociacoes() {\n    return Promise.all([\n      this.getNegociacoesDaSemana(),\n      this.getNegociacoesDaSemanaAnterior(),\n      this.getNegociacoesDaSemanaRetrasada(),\n    ]).then(importacoes => importacoes.reduce((arrayAchatado, array) => arrayAchatado.concat(array), []));\n  }\n}"]}
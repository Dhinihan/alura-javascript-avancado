{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Bind","DataHelper","ListaNegociacoes","Mensagem","Negociacao","NegociacaoService","MensagemView","NegociacaoView","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_service","_view","_listaNegociacao","_mensagemView","_mensagem","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","error","importaNegociacoes","setInterval","event","preventDefault","_criaNegociacao","cadastra","resultado","_limpaFormulario","erro","apaga","esvazia","service","reduce","arrayAchatado","array","concat","filter","some","JSON","stringify","negociacaoDentro","textoParaData","value","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Bind } from '../helpers/Bind';\nimport { DataHelper } from '../helpers/DataHelper';\nimport { ListaNegociacoes } from '../models/ListaNegociacoes';\nimport { Mensagem } from '../models/Mensagem';\nimport { Negociacao } from '../models/Negociacao';\nimport { NegociacaoService } from '../services/NegociacaoService';\nimport { MensagemView } from '../views/MensagemView';\nimport { NegociacaoView } from '../views/NegociacaoView';\n\nexport class NegociacaoController {\n\n  constructor() {\n    let $ = document.querySelector.bind(document);\n\n    this._inputData = $('#data');\n    this._inputQuantidade = $('#quantidade');\n    this._inputValor = $('#valor');\n    this._service = new NegociacaoService();\n\n    this._view = new NegociacaoView($('#NegociacaoView'));\n    /** @type ListaNegociacoes */\n    this._listaNegociacao = new Bind(new ListaNegociacoes(), this._view, 'adiciona', 'esvazia');\n\n    this._mensagemView = new MensagemView($('#MensagemView'));\n    /** @type Mensagem */\n    this._mensagem = new Bind(new Mensagem(), this._mensagemView, 'texto');\n\n    this._init();\n  }\n\n  _init() {\n    this._service.lista()\n      .then(negociacoes => negociacoes.forEach(negociacao => this._listaNegociacao.adiciona(negociacao)))\n      .catch(error => this._mensagem.texto = error);\n\n    this.importaNegociacoes();\n    setInterval(() => {\n      this.importaNegociacoes();\n    }, 10000);\n  }\n\n  adiciona(event) {\n    event.preventDefault();\n    let negociacao = this._criaNegociacao();\n    this._service.cadastra(negociacao)\n      .then(resultado => {\n        this._mensagem.texto = resultado;\n        this._listaNegociacao.adiciona(negociacao);\n        this._limpaFormulario();\n      })\n      .catch(erro => this._mensagem.texto = erro);\n\n  }\n\n  apaga() {\n    this._service.apaga()\n      .then(resultado => {\n        this._listaNegociacao.esvazia();\n        this._mensagem.texto = resultado;\n      })\n      .catch(error => this._mensagem.texto = error);\n  }\n\n  importaNegociacoes() {\n    let service = new NegociacaoService();\n    service.importaNegociacoes().then(negociacoes => {\n      negociacoes\n        .reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\n        .filter(negociacao =>\n          !this._listaNegociacao.lista.some(negociacaoDentro =>\n            JSON.stringify(negociacao) == JSON.stringify(negociacaoDentro)\n          ))\n        .forEach(negociacao => this._listaNegociacao.adiciona(negociacao));\n      this._mensagem.texto = 'Negociações importadas com sucesso.';\n    }).catch(erro => this._mensagem.texto = erro);\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(\n      DataHelper.textoParaData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value)\n    );\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = '';\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0;\n\n    this._inputData.focus();\n  }\n}\n"]}